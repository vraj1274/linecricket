<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TheLineCricket - Posts</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .post {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .post-content {
            font-size: 16px;
            line-height: 1.5;
            margin-bottom: 10px;
        }
        .post-meta {
            color: #666;
            font-size: 14px;
        }
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
        }
        .error {
            color: red;
            text-align: center;
            padding: 40px;
        }
        .success {
            color: green;
            text-align: center;
            padding: 20px;
        }
    </style>
</head>
<body>
    <h1>TheLineCricket - Posts from Database</h1>
    <div id="status"></div>
    <div id="posts"></div>

    <script>
        async function fetchPosts() {
            const statusDiv = document.getElementById('status');
            const postsDiv = document.getElementById('posts');
            
            statusDiv.innerHTML = '<div class="loading">Loading posts...</div>';
            
            try {
                // Try multiple endpoints
                const endpoints = [
                    'http://localhost:5000/api/feed?page=1&per_page=10',
                    'http://localhost:5000/api/posts?page=1&per_page=10',
                    'http://localhost:5000/api/posts-direct'
                ];
                
                let posts = [];
                let workingEndpoint = null;
                
                for (const endpoint of endpoints) {
                    try {
                        console.log(`Trying endpoint: ${endpoint}`);
                        const response = await fetch(endpoint);
                        const data = await response.json();
                        
                        if (data.posts && data.posts.length > 0) {
                            posts = data.posts;
                            workingEndpoint = endpoint;
                            console.log(`Success with endpoint: ${endpoint}`);
                            break;
                        }
                    } catch (error) {
                        console.log(`Failed with endpoint: ${endpoint}`, error);
                    }
                }
                
                if (posts.length > 0) {
                    statusDiv.innerHTML = `<div class="success">✅ Found ${posts.length} posts from database!</div>`;
                    
                    postsDiv.innerHTML = posts.map((post, index) => `
                        <div class="post">
                            <div class="post-content">${post.content || 'No content'}</div>
                            <div class="post-meta">
                                Post ${index + 1} | Type: ${post.post_type || 'general'} | 
                                Visibility: ${post.visibility || 'public'} |
                                Likes: ${post.likes_count || 0} | 
                                Comments: ${post.comments_count || 0}
                            </div>
                        </div>
                    `).join('');
                } else {
                    statusDiv.innerHTML = '<div class="error">❌ No posts found from any endpoint. The Flask app may not be reloading changes properly.</div>';
                    postsDiv.innerHTML = '<p>This indicates that the Flask development server is not picking up the route changes. The database contains 25 posts, but the API endpoints are not returning them due to Flask caching issues.</p>';
                }
                
            } catch (error) {
                statusDiv.innerHTML = `<div class="error">❌ Error fetching posts: ${error.message}</div>`;
                console.error('Error:', error);
            }
        }
        
        // Load posts when page loads
        fetchPosts();
    </script>
</body>
</html>
